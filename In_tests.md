### **Тестовый сценарий 1: Проверка работы системы при пониженном и повышенном напряжении питания**

**Ожидаемые результаты:**
- **При пониженном напряжении (около -10-15% от 24V, т.е. примерно 20V):**
  - Система функционирует корректно.
  - Индикаторы питания светятся, хотя и менее ярко.
  - Напряжения на ключевых точках (после конвертации на 3.3V) находятся в допустимых пределах.
  - Компоненты не перегреваются.
  
- **При повышенном напряжении (около +10-15% от 24V, т.е. примерно 26.5V):**
  - Срабатывают защитные механизмы (предохранители разрывают цепь при превышении).
  - Индикаторы питания светятся ярче, чем при номинальном напряжении питания.
  - Напряжения на ключевых точках не превышают допустимых значений или отсутствуют из-за разрыва цепи.
  - Компоненты не перегреваются.

**Шаги:**
1. Вставьте все дочерние платы (плата контроллера, симисторная плата, плата аналоговых входов/выходов, плата цифровых входов/выходов, плата моторов постоянного тока, плата шаговых двигателей, плата свето/фотодиодов, плата QR кодов) через соответствующие разъёмы на материнской плате.
2. Подключите источник питания 24V.
3. **Проверка пониженного напряжения:**
   - Установите напряжение питания линии +24V на 20.4V (~-15%).
   - Подключите разъем питание к материнской плате.
   - Подайте питание.
   - Убедитесь, что светодиоды D12 и D14 светятся, возможно и менее ярко.
   - Подключите по одной дочерней плате (например, плату контроллера). ОПЦИОНАЛЬНО: проверьте её работу согласно приёмочным тестам.
   - Измерьте напряжение на ключевых точках (после конвертации на 3.3V) и убедитесь, что они находятся в допустимых пределах.
   - Проверьте температуру компонентов (Q1, Q3, U2, D12, D14 и т.д.) с помощью пирометра. Температура не должна превышать 40°C.
4. Отключите питание.
5. **Проверка повышенного напряжения:**
   - Установите напряжение питания линии +24V на 26.4V (~+10%).
   - Подключите питание к материнской плате.
   - Включите питание.
   - Убедитесь, что светодиоды D12 и D14 горят чрезмерно ярко.
   - Проверьте предохранители на материнской плате и дочерних платах (например, предохранитель F6 на симисторной плате). Убедитесь, что предохранители сработали, разорвав цепь питания.
   - Измерьте напряжение на ключевых точках и убедитесь, что они не превышают допустимых значений или отсутствуют из-за разрыва цепи.
   - Проверьте температуру компонентов. Она не должна превышать 40°C.

---

### **Тестовый сценарий 2: Проверка устойчивости системы при колебаниях напряжения питания**

**Ожидаемые результаты:**
- Система стабильно функционирует при колебаниях напряжения питания в пределах допустимых значений.
- Индикаторы питания корректно отображают изменения напряжения.
- Напряжения на ключевых точках остаются в пределах спецификаций.
- Компоненты не перегреваются.

**Шаги:**
1. Вставьте все дочерние платы через соответствующие разъёмы на материнской плате.
2. Подключите источник питания 24V с возможностью плавной корректировки выходного напряжения.
3. Настройте источник питания для генерации колебаний напряжения +24V ±5% (от 22.8V до 25.2V).
4. Подключите питание к материнской плате.
5. Включите питание.
6. Убедитесь, что светодиоды D12 и D14 стабильно светятся.
7. Подключите по одной дочерней плате (например, плату контроллера). ОПЦИОНАЛЬНО: проверьте её работу согласно приёмочным тестам.
8. Регулярно измеряйте напряжение на ключевых точках (после конвертации на 3.3V) и убедитесь, что они находятся в пределах спецификаций.
9. Проверьте температуру компонентов с помощью пирометра. Температура не должна превышать 40°C.

---

### **Тестовый сценарий 3: Проверка срабатывания защитных механизмов при выходе напряжения за пределы допустимых значений**

**Ожидаемые результаты:**
- При превышении максимально допустимого напряжения срабатывают защитные механизмы (предохранители разрывают цепь).
- Индикаторы питания сигнализируют о перегрузке (уточнить, возможно ли это реализовать)
- Напряжения на ключевых точках либо находятся в пределах спецификаций, либо отсутствуют из-за разрыва цепи.
- Компоненты не перегреваются и не повреждаются.

**Шаги:**
1. Вставьте все дочерние платы через соответствующие разъёмы на материнской плате.
2. Подключите источник питания 24V с возможностью подачи превышающего напряжения.
3. Установите напряжение питания линии +24V на 30V (+25% от номинала).
4. Подключите питание к материнской плате.
5. Включите питание.
   - Убедитесь, что светодиоды D12 и D14 мигнули или ярко горят.
   - Проверьте предохранители на материнской плате и дочерних платах (например, предохранитель F6 на симисторной плате). Убедитесь, что предохранители сработали, разорвав цепь.
   - Измерьте напряжение на ключевых точках. Оно должно быть либо в пределах спецификаций, либо отсутствовать из-за отключения питания.
   - Проверьте температуру компонентов с помощью пирометра. Температура не должна превышать 40°C.
6. Отключите питание.
7. Установите напряжение питания линии +24V на 18V (-25% от номинала).
8. Подключите питание к материнской плате.
9. Включите питание.
    - Убедитесь, что светодиоды D12 и D14 сигнализируют о недостаточном питании (горят менее ярко)
    - Проверьте, что дочерние платы отключились или работают в ограниченном режиме.
    - Измерьте напряжение на ключевых точках. (нужно расписать, на каких именно)
    - Проверьте температуру компонентов. Она не должна превышать 40°C.
10. Убедитесь, что защитные механизмы корректно срабатывают при выходе напряжения за пределы допустимых значений.
11. Система должна переходить в безопасное состояние, предотвращая повреждение компонентов.

---

### **Тестовый сценарий 4: Проверка источников питания на номинальную нагрузку**

**Ожидаемые результаты:**
- При подаче номинальных значений напряжения 24V от тестовых источников питания все дочерние платы функционируют корректно.
- Светодиодные индикаторы питания (D12, D14 на материнской плате) стабильно светятся, отражая номинальные условия работы.
- На контрольных точках TP7 (линия 24V), а также на выходах конвертации 3.3V напряжения соответствуют заданным в ТЗ нормам (напр. TP7≥22V, выходы 3.3V в диапазоне 3.0-3.6V).
- Компоненты, такие как Q1, Q3, U2, а также силовые элементы на дочерних платах, не перегреваются (температура ≤40°C).
- Реле на плате аналоговых входов/выходов срабатывает без дребезга.
- Питание логики на плате контроллера стабильно: микроконтроллер Nucleo-64F411 функционирует без сбоев, шина RS485 активна и без ошибок.
- На плате двигателей постоянного тока и шаговых двигателей питание поступает на драйверы без провалов и выбросов. Двигатели при подаче EN-сигналов вращаются ровно, без рывков и посторонних шумов.

**Шаги:**
1. Подключите все дочерние платы (контроллер, симисторную, аналоговых и цифровых I/O, двигателя постоянного тока, шаговых двигателей, свето/фотодиодов, QR кодов) к материнской плате через соответствующие краевые разъемы. Убедитесь, что платы вставлены до упора, не перекошены.
2. Подключите источник питания 24V.
3. Установите точное значение: +24V (±1%).
4. Подключите питание к материнской плате.
5. Включите питание.
6. Убедитесь, что светодиоды D12 и D14 на материнской плате горят ровно, без мерцания.
7. Подключите тестовые нагрузки:
   - Для аналого-цифровой платы включите макетный вентилятор на один из каналов 220VAC (через симисторную плату). В данном режиме вентилятор пока не запитан 220VAC, но логика готова.
   - Для платы моторов постоянного тока подайте команду на минимальные обороты (через ПО на контроллере) и убедитесь, что при наличии питания двигатели не стартуют до подачи разрешающих сигналов (EN).
   - Для платы шаговых двигателей подайте тестовый Step/Dir сигнал на низкой частоте и убедитесь, что при нормальном питании шаговые двигатели позиционируются корректно.
   - Для платы QR кодов убедитесь, что подсветка для сканеров получает стабильное 3.3V.
8. Измерьте мультиметром напряжение на TP7 (24V линия) и на выходах конвертации 3.3V. Запишите значения.
9. Измерьте температуру ключевых компонентов (Q1, Q3, U2, силовые транзисторы на драйверах двигателей и т.д.) пирометром – она не должна превышать 40°C.
10. Подайте сигнал на включение реле на аналоговой плате (если имеется). Убедитесь, что при 24V реле срабатывает четко.
11. Убедитесь, что все функции логического контроллера работают без сбоев, RS485-коммуникация с дочерними платами идет без ошибок (тестовое ПО может запросить статусы плат).
12. Отключите питание. Проверьте отсутствие запаха гари, перегрева или механических повреждений.

---

### **Тестовый сценарий 5: Проверка логических уровней**

**Ожидаемые результаты:**
- Все цифровые и логические сигнальные линии, включая RS485, RTS, PWM, Dir/Step/Enable для двигателей, имеют корректные логические уровни согласно спецификации (например, для 5В логики: высокий уровень ≥4.7В, низкий ≤0.8В; для 3.3В логики – высокий ≥3.0В, низкий ≤0.4В).
- На линии RS485 не наблюдается «плавающих» уровней. При неактивной линии должен быть известный пассивный уровень (терминация линий активна).
- Линии RTS, отдельно выделенные на каждую дочернюю плату, поднимаются до номинала при запросе ведущего (контроллера) и опускаются при отсутствии активности.
- Сигналы для симисторных ключей, транзисторных выходов (светодиодных плат), а также входы датчиков (термопары, датчики тока) при логической проверке соответствуют нормам (на входах – устойчиво низкий уровень шума, на выходах – четкие переходы без искажений).

**Шаги:**
1. Подайте номинальное питание 24V.
2. Подключите логический анализатор или осциллограф к линиям RS485, RTS, цифровым входам/выходам на материнской плате и на контактах дочерних плат.
3. Инициируйте на контроллерной плате тестовую программу, отправляющую регулярные опросы по шине RS485 к каждой дочерней плате.
4. Измерьте уровни сигналов RTS при активном и неактивном состоянии (например, для платы симисторов, аналоговых I/O, шаговых двигателей). Запишите результаты.
5. Переключите логические выходы на плате контроллера (через ПО) из состояния LOW в HIGH и обратно, убедитесь, что переходы четкие, без задержек или «паразитных» колебаний уровня.
6. Для платы двигателей постоянного тока подайте ШИМ-сигнал с частотой 2 кГц и убедитесь, что форма сигнала соответствует ожидаемой, уровень HIGH не ниже 4.7В (если логика 5В) или не ниже 3.0В (для 3.3В линий), уровень LOW близок к 0В.
7. Для платы шаговых двигателей проверьте сигналы Dir, Step, Enable – при смене направления (Dir) уровень меняется четко, Step импульсы стабильны по амплитуде, Enable уверенно удерживает логический уровень без просадок.
8. Для платы свето/фотодиодов убедитесь, что цифровые выходы, управляющие светодиодами, поднимаются до номинала и не имеют дребезга или медленных фронтов.
9. Все измерения должны быть зафиксированы. При отклонениях более чем на 5% от номинала необходимо отметить в протоколе.
10. Отключите питание и убедитесь в отсутствии негативных последствий для логических линий.

---

### **Тестовый сценарий 6: Проверка обмена данными без ошибок и задержек**

**Ожидаемые результаты:**
- При обмене данными по шине RS485 (контроллер ↔ все дочерние платы) данные передаются без CRC-ошибок, задержек или пропусков пакетов.
- Все дочерние платы отвечают в заданное время (например, не более 50 мс задержки ответа).
- При одновременном опросе нескольких модулей (аналоговых I/O, симисторной, QR-кодов, двигателей) не происходит коллизий на линии, RTS-сигналы корректно распределяют доступ к шине.
- Передача данных о температуре, токе, состояниях реле, положении двигателей (шаговых или DC) происходит без искажений. Значения считаемых параметров адекватны реальности (например, ток при неработающем вентиляторе ≈0А, температура в помещении ≈20-25°C).

**Шаги:**
1. Включите стенд с материнской и всеми дочерними платами, подайте номинальное питание 24V.
2. Подключите к контроллерной плате ПК с отладочным ПО, которое способно формировать запросы по RS485 ко всем дочерним платам.
3. Запустите цикл опроса:
   - Дочерняя плата аналоговых I/O: запросите показания тока, температуры, состояние реле.
   - Дочерняя плата симисторов: запросите состояние каналов, убедитесь, что ответы приходят без ошибок.
   - Дочерняя плата двигателей постоянного тока: запросите текущее задание скорости, направление, убедитесь, что ответ достоверен.
   - Дочерняя плата шаговых двигателей: запросите текущую позицию, состояние входов конечных выключателей.
   - Плата свето/фотодиодов: запросите состояние фотоэлементов, убедитесь, что сигналы поступают без задержек.
   - Плата QR кодов: запросите статус подключенных сканеров, убедитесь, что UART-данные преобразуются корректно и возвращаются по RS485 без искажений.
4. Логгером или отладочным ПО зафиксируйте время ответа каждого модуля. Сравните с ожидаемым временем (<50 мс).
5. Повторите тест многократно (например, 100 циклов опроса), убедитесь в отсутствии CRC-ошибок в принятых пакетах.
6. Для проверки помехоустойчивости: кратковременно измените нагрузку на аналоговой плате (включите вентилятор на симисторной плате), убедитесь, что при скачке тока обмен данными не нарушается.
7. Зафиксируйте результат в протоколе, убедитесь, что все значения находятся в ожидаемых пределах, нет пропусков пакетов или нестабильности ответов.

---

### **Тестовый сценарий 7: Проверка срабатывания защиты от перенапряжения и обратной полярности**

**Ожидаемые результаты:**
- **При перенапряжении:**
  - При подаче заведомо превышающего номинала напряжения (например, +30V на линию 24V, что ~+25% от номинала) срабатывают защитные механизмы: предохранители (например, F6 на симисторной плате) перегорают или разрывают цепь.
  
- **При обратной полярности питания:**
  - Система не выходит из строя.
  - Срабатывают элементы защиты (диоды, стабилитроны), питание не достигает чувствительных компонентов.
  
- После снятия ненормальных условий и замены предохранителей (при необходимости) плата возвращается к нормальному функционированию.

**Шаги:**
1. Подключите материнскую плату и все дочерние платы к тестовому стенду с регулируемым источником питания, способным выдавать повышенное напряжение и изменять полярность.
2. **Проверка перенапряжения:**
   - Установите повышенное напряжение на 24V линию: 30V.
   - Не подавайте питание сразу на плату – сначала отключите питание, выставьте напряжение, затем подайте питание.
   - Проверьте состояние предохранителей (например, F6 на симисторной плате). Он должен сработать и разорвать цепь.
   - Измерьте напряжение на TP7 – оно должно пропасть или упасть до безопасного уровня.
   - Измерьте температуру ключевых элементов – не должно быть перегрева сверх нормативов, так как цепь прервана.
   - Отключите питание, восстановите номинальное напряжение (24V), замените предохранитель на идентичный новый.
   - Включите питание. Убедитесь, что система вновь работает штатно.
   
3. **Проверка защиты от обратной полярности:**
   - Отключите питание.
   - Инвертируйте полярность подключения питания (плюс на GND, минус на +24V вход).
   - Включите питание.
   - Убедитесь, что индикаторы либо не загораются, либо сигнализируют отказ, но при этом не происходит повреждения компонентов.
   - Измерьте напряжение на TP7, TP1, TP4 – оно должно отсутствовать или прерываться элементами защиты.
   - Отключите питание, восстановите правильную полярность.
   - Убедитесь, что после возвращения к нормальному подключению система снова работоспособна.

---

### **Тестовый сценарий 8: Тестирование внезапных отключений (питания отдельных плат и внешнего)**

**Ожидаемые результаты:**
- При внезапном отключении питания 24V система безопасно останавливается: двигатели перестают вращаться, симисторы перестают коммутировать напряжение, реле размыкается.
- После повторной подачи питания система корректно инициализируется, не теряет критические данные и продолжает работу без повреждений или сбоев.
- При отключении питания у отдельных дочерних плат встроенные механизмы защиты предотвращают некорректные сигналы: двигатели не вращаются самопроизвольно, симисторы не включаются.

**Шаги:**
1. Подайте системе номинальное напряжение 24V. Все платы установлены, обмен данными идет штатно.
2. В разгар обмена данными и работы исполнительных механизмов (вентиляторы, двигатели, симисторы) отключите внешнее питание 24V.
3. Наблюдайте за поведением:
   - Двигатели должны остановиться немедленно.
   - Светодиоды погаснут.
4. Спустя несколько секунд подайте питание обратно. Убедитесь, что система переходит в исходное состояние: микроконтроллер инициализируется, шина RS485 возобновляет обмен без ошибок.
5. Повторите тест с отключением питания у одной из дочерних плат (например, физически отключите плату шаговых двигателей) при сохранении питания материнской платы.
   - Убедитесь, что оставшиеся платы работают стабильно.
   - Нет ложного включения других нагрузок.
6. После повторного включения отключенной платы шаговых двигателей убедитесь, что они не начинают вращаться хаотично. Их логика должна быть в безопасном состоянии до явной команды включения.
7. Зафиксируйте результаты, убедитесь, что кратковременные отключения не приводят к повреждениям.

---

### **Тестовый сценарий 9: Механическое тестирование краевых разъёмов (многократное подключение/отключение)**

**Ожидаемые результаты:**
- Повторные циклы извлечения и установки дочерних плат в материнскую плату не приводят к механическим повреждениям разъемов: контакты не гнутся, пластиковые направляющие не ломаются.
- После 10-20 циклов «вынуть-вставить» каждая дочерняя плата корректно определяется контроллером и функционирует без сбоев.
- Электрические соединения после повторных подключений остаются надежными: нет увеличения переходного сопротивления, нет снижения уровня сигналов.

**Шаги:**
1. Отключите питание.
2. Извлеките одну из дочерних плат (например, плату аналоговых I/O) из краевого разъема материнской платы. Внимательно осмотрите разъемы на предмет механических повреждений.
3. Вставьте плату обратно, убедитесь, что она входит плавно, без заеданий, контакты совмещаются корректно.
4. Повторите процесс извлечения и вставки 10-20 раз. После каждого цикла осматривайте разъемы и следите за отсутствием механических дефектов.
5. Подключите питание, проверьте работоспособность извлеченной и заново вставленной платы: данные с датчиков должны считываться корректно, сигналы на выходы формироваться без искажений.
6. Повторите тест для других плат (симисторной, платы двигателей, QR кодов).
7. Зафиксируйте результаты. Если после многократных подключений/отключений контакты остаются чистыми, прямыми, а функциональность полная – тест считается успешным.


---

### **Тестовый сценарий 10: Одновременное включение всех линий RTS**

**Ожидаемые результаты:**
- При подаче команды с контроллера все дочерние платы практически одновременно поднимают линии RTS.
- Таймштампы на дочерних платах при активации RTS соответствуют таймштампам, зафиксированным на материнской плате, с рассогласованием не более нескольких миллисекунд.
- На линии RS485 не наблюдаются коллизии: RTS-сигналы позволяют последовательно и предсказуемо раздать доступ к шине.
- При отключении RTS на контроллере дочерние платы опускают сигнал синхронно, без задержек.

**Шаги:**
1. Включите систему, подайте номинальное питание 24V, убедитесь в штатной работе логики.
2. Подключите осциллограф или логический анализатор к RTS линиям всех дочерних плат, а также к соответствующим контактам на материнской плате. (Ввиду недостаточного количества выходов осциллографа, предлагаю подключать попарно (контроллер\дочерняя))
3. На плате контроллера или ПК с отладочным ПО запустите команду одновременной активации RTS для всех подключенных модулей.
4. Наблюдайте сигналы: все RTS-линии должны подняться в течение короткого интервала времени (1-2 мс).
5. Зафиксируйте таймштампы активации RTS на дочерних платах (может потребоваться внутренний лог датчиков времени или протоколирование в ПО контроллера) и сравните с таймштампами, записанными контроллером.
6. Отключите все RTS линии через команду контроллера, убедитесь, что они опускаются синхронно.
7. Повторите тест несколько раз для уверенности в стабильности результата.
8. При рассогласованиях более чем в несколько миллисекунд отметить в протоколе и выявить причину задержки.

---

### **Тестовый сценарий 11: Проверка наличия помех на сигнальных линиях при работе двигателей или симисторной платы**

**Ожидаемые результаты:**
- При работе двигателей (подаче EN-сигнала, Step/Dir для шаговых двигателей, ШИМ для DC двигателей) и включении нагрузки на симисторной плате, уровень шумов на аналоговых входах не превышает допустимых значений, определенных в ТЗ (например, не более 5% отклонения от измеряемого сигнала).
- Расположение симисторной платы рядом с платой аналоговых входов/выходов не приводит к существенному росту помех (сравнить уровни шума до и после перестановки).
- На цифровых сигнальных линиях (Dir, Step, Enable) не появляется искаженных или «дрожащих» фронтов, RS485 не демонстрирует увеличения ошибок передачи.

**Шаги:**
1. Включите систему, подайте номинальное питание 24V.
2. Измерьте начальный уровень шумов на аналоговых входах при бездействии исполнительных механизмов (двигатели, симисторы не включены).
3. Активируйте двигатель постоянного тока на низких оборотах через ШИМ-сигнал и одновременно включите один из симисторных каналов для питания макетной нагрузки (например, лампы накаливания или вентилятора 220VAC).
4. Повторно измерьте уровень шумов на аналоговых входах. Сравните результаты с эталонными (пассивное состояние).
5. Расположите симисторную плату максимально близко к плате аналоговых I/O (предусмотрено конструкцией), снова активируйте симистор и двигатели, измерьте шум. Зафиксируйте изменения.
6. Проверьте линии RS485 во время работы двигателей и симисторов – должен отсутствовать рост ошибок или нестабильность сигнала.
7. При обнаружении уровня шума выше нормы, отметьте это, проверьте экранирование кабелей или заземление плат.
8. Отключите нагрузки (двигатели, симисторы), убедитесь, что уровень шумов возвращается к номинальному.

---

### **Тестовый сценарий 12: Тестирование влияния силовых потребителей на показания аналоговых датчиков**

**Ожидаемые результаты:**
- При работе силовых потребителей показания датчиков тока и температуры не изменяются вне допустимого диапазона.
- Если датчик тока регистрирует нагрузку при включении двигателя или симистора, уровень сигнала должен меняться линейно и предсказуемо, без рывков и шумовых пиков.
- Температурный датчик (например, термистор или термопара) не должен показывать ложного повышения температуры из-за электромагнитных наводок от силовых цепей.

**Шаги:**
1. Подайте номинальное питание 24V и включите систему в штатном режиме.
2. Снимите эталонные показания аналоговых датчиков тока и температуры в состоянии покоя (двигатели остановлены, симисторы не активны).
3. Включите двигатель постоянного тока, постепенно увеличивая ШИМ от минимального к среднему значению, измеряйте ответ датчика тока. Он должен возрастать пропорционально нагрузке на двигатель, без скачкообразных искажения сигнала.
4. Включите шаговый двигатель и подайте импульсы на Step/Dir. Во время вращения измеряйте показания датчика тока: при плавной нагрузке не должно быть резких выбросов.
5. Активируйте симисторную плату (включите одну из линий на макетную нагрузку 220VAC) и параллельно измеряйте показания датчика температуры. Температура не должна ощутимо меняться, если датчик не нагревается реально. Электромагнитные помехи не должны создавать ложных сигналов.
6. Измеряйте уровень шумов на выходах датчиков во время одновременной работы симистора и двигателя. Сравните с эталоном.
7. При необходимости измените расположение плат или примените дополнительные экранирующие меры, чтобы убедиться, что влияние помех сведено к минимуму.
8. Отключите силовые нагрузки и убедитесь, что сигналы датчиков возвращаются к исходному уровню.
9. Все результаты зафиксируйте в протоколе. При обнаружении отклонений, превышающих допустимые нормы, отметить необходимую доработку (экранирование, фильтрация сигналов).

