# Интеграционные Тесты Электроники

В данном разделе описаны интеграционные тесты для проверки взаимодействия платы контроллера и дочерних плат, подключённых к материнской плате как коммутационной платформе. Тесты охватывают проверку питания, шины данных и коммуникации, функциональное тестирование отдельных плат, а также проверку систем защиты и безопасности. Каждый тест включает пошаговые инструкции и ожидаемые результаты для обеспечения качественной и надёжной работы электронной системы.

## Тестирование Питания

### Проверка крайних значений напряжения питания

**Цель:** Убедиться, что система корректно работает при минимальных и максимальных допустимых значениях входного напряжения питания.

**Шаги:**

1. **Подготовка оборудования:**
   - Используйте источник питания с регулируемым выходным напряжением.
   - Подключите материнскую плату к источнику питания через соответствующие разъёмы.

2. **Минимальное напряжение:**
   - Установите выходное напряжение источника питания на нижний предел допустимого (например, 18 В).
   - Включите питание.
   - Измерьте напряжения на основных линиях питания: +24V, +3.3V\RS485, GND с помощью мультиметра.

3. **Максимальное напряжение:**
   - Увеличьте выходное напряжение до верхнего предела допустимого (±30V).
   - Измерьте напряжения на тех же линиях питания.
   - Оставьте систему включённой на 5 минут для проверки стабильности.

4. **Документирование результатов:**
   - Запишите измеренные значения напряжений при минимальном и максимальном входном напряжении.
   - Зафиксируйте любые отклонения или нестабильности.

**Ожидаемый результат:**

- Напряжения на линиях питания остаются в пределах допустимых значений (например, +24V ±5%, +3.3V\RS485 ±5%).
- Система функционирует стабильно без сбоев при обоих крайних значениях напряжения.
- Нет значительных колебаний или отклонений напряжения во время теста.

### Проверка источников питания на номинальную нагрузку

**Цель:** Проверить способность источников питания обеспечивать стабильное напряжение при номинальной нагрузке.

**Шаги:**

1. **Подключение нагрузок:**
   - Подключите все дочерние платы (плата контроллера, симисторная плата, плата аналоговых входов/выходов и т.д.) к материнской плате.
   - Вся нагрузка, питающаяся от материнской платы, должна быть подключена (сквозную нагрузку дочерних плат можно не подключать).

2. **Подача питания:**
   - Подключите 24 В к разъёмам J26 и J27 материнской платы.
   - Включите питание системы.

3. **Измерение параметров:**
   - В течение 2 минут измеряйте напряжение на каждой линии питания дочерних плат.
   - Измерьте температуру транзисторов Q1, Q3 с помощью инфракрасного термометра.

4. **Проверка функциональности нагрузок:**
   - Убедитесь, что все подключенные нагрузки функционируют корректно (например, светодиоды светятся, двигатели работают).

5. **Документирование результатов:**
   - Запишите измеренные значения напряжений и температур.
   - Зафиксируйте любые отклонения или перегрев компонентов.

**Ожидаемый результат:**

- Напряжение на каждой линии питания дочерних плат составляет не менее 22 В.
- Температура транзисторов не превышает 40°C.
- Все нагрузки функционируют без сбоев и перегревов.

## Тестирование Шины Данных и Коммуникации

### Проверка логических уровней

**Цель:** Убедиться, что логические уровни на шине данных соответствуют спецификациям RS485 и обеспечивают надёжную передачу данных.

**Шаги:**

1. **Подготовка оборудования:**
   - Подключите плату контроллера и несколько дочерних плат (например, плату двигателей) к источнику питания.
   - Подключите осциллограф или логический анализатор к линиям данных RS485.

2. **Запуск тестовой прошивки:**
   - Загрузите прошивку `controller_test` на плату контроллера.
   - Запустите обмен данными между платой контроллера и дочерними платами.

3. **Измерение логических уровней:**
   - Используя осциллограф, измерьте напряжение на линиях A и B RS485.
   - Проверьте соответствие логических уровней спецификациям (0V и 3.3V или 5V).

4. **Анализ сигналов:**
   - Проверьте наличие шумов, перекрытий или неправильных уровней напряжения.
   - Убедитесь, что сигналы чистые и стабильные.

5. **Документирование результатов:**
   - Запишите измеренные значения логических уровней.
   - Зафиксируйте любые аномалии или несоответствия спецификациям.

**Ожидаемый результат:**

- Логические уровни на линиях A и B соответствуют спецификациям RS485.
- Отсутствуют шумы и перекрытия напряжений.
- Сигналы передаются чётко и стабильно без искажений.

### Проверка обмена данными без ошибок и задержек

**Цель:** Убедиться в надёжности и скорости обмена данными между платой контроллера и дочерними платами.

**Шаги:**

1. **Подключение оборудования:**
   - Подключите плату контроллера и до 10 дочерних плат к источнику питания и шине RS485.
   - Загрузите прошивки `data_exchange_test` на дочерние платы и `controller_test` на плату контроллера.

2. **Инициализация обмена данными:**
   - Запустите обмен данными между платой контроллера и дочерними платами.
   - Отправьте тестовые данные (например, 10 байт) с платы контроллера на дочерние платы.

3. **Измерение времени задержки:**
   - Используя программное обеспечение или средства измерения, зафиксируйте время отправки и получения данных.
   - Рассчитайте задержку передачи данных.

4. **Проверка целостности данных:**
   - Сравните отправленные данные с полученными на стороне дочерних плат.
   - Убедитесь в отсутствии ошибок передачи (битовых ошибок, потерь данных).

5. **Документирование результатов:**
   - Запишите измеренное время задержки и результаты проверки целостности данных.
   - Зафиксируйте любые обнаруженные ошибки или задержки.

**Ожидаемый результат:**

- Данные передаются без ошибок и потерь.
- Задержка передачи данных находится в пределах допустимых значений (например, менее 100 мс).
- Отправленные и полученные данные полностью совпадают.

## Функциональное Тестирование Отдельных Плат

### Проверка работы платы контроллера

**Цель:** Убедиться в корректной работе платы контроллера, включая управление линиями RTS и обмен данными через RS485.

**Шаги:**

1. **Подключение оборудования:**
   - Подключите материнскую плату к источнику питания и компьютеру.
   - Загрузите прошивку `controller_test` на плату контроллера.

2. **Управление линиями RTS:**
   - Используйте программное обеспечение для отправки тестовых команд через RS485.
   - Отправьте команды для подъёма и опускания линий RTS.

3. **Наблюдение за поведением линий RTS:**
   - Используя мультиметр или осциллограф, измерьте состояние линий RTS в ответ на команды.
   - Убедитесь, что линии RTS корректно реагируют на команды (поднимаются и опускаются).

4. **Проверка обмена данными:**
   - Отправьте тестовые данные с платы контроллера и проверьте их приём на дочерних платах.
   - Убедитесь в целостности и корректности переданных данных.

5. **Документирование результатов:**
   - Запишите наблюдаемые состояния линий RTS и результаты обмена данными.
   - Зафиксируйте любые отклонения или сбои в работе контроллера.

**Ожидаемый результат:**

- Плата контроллера корректно управляет линиями RTS согласно отправленным командам.
- Обмен данными через RS485 осуществляется без ошибок и задержек.
- Данные передаются и принимаются полностью и корректно.

### Проверка работы платы двигателей постоянного тока

**Цель:** Убедиться в корректной работе платы двигателей постоянного тока, включая управление направлением и скоростью вращения моторов.

**Шаги:**

1. **Подключение оборудования:**
   - Подключите плату двигателей к источнику питания через дополнительный разъём.
   - Подключите плату двигателей к плате контроллера через шину RS485.
   - Загрузите прошивку `dc_motor_test` на плату двигателей.

2. **Управление направлениями вращения:**
   - Отправьте команды для изменения направления вращения каждого двигателя.
   - Наблюдайте за изменением направления вращения моторов.

3. **Регулировка скорости вращения:**
   - Отправьте команды для изменения скорости вращения моторов с шагом 1%.
   - Измерьте фактическую скорость вращения моторов с помощью тахометра или другого измерительного устройства.

4. **Остановка моторов:**
   - Отправьте команду остановки для каждого мотора.
   - Убедитесь, что моторы останавливаются мгновенно и без задержек.

5. **Документирование результатов:**
   - Запишите изменения направления и скорости вращения, а также время остановки моторов.
   - Зафиксируйте соответствие фактических значений отправленным командам.

**Ожидаемый результат:**

- Моторы корректно изменяют направление вращения по командам.
- Скорость вращения регулируется с шагом 1%, соответствуя отправленным командам.
- Моторы останавливаются по команде без задержек и сбоев.
- Все команды выполняются корректно и без ошибок.

### Проверка работы симисторной платы

**Цель:** Убедиться в корректной работе симисторной платы, включая управление мощностью нагревательных элементов и считывание их состояния.

**Шаги:**

1. **Подключение оборудования:**
   - Подключите симисторную плату к источнику питания 230V через соответствующие разъёмы.
   - Подключите симисторную плату к плате контроллера через шину RS485.
   - Загрузите прошивку `triac_control_test` на симисторную плату.

2. **Переключение режимов работы:**
   - Отправьте команды для переключения нагревательных элементов в режим высокой мощности.
   - Измерьте мощность нагревательных элементов с помощью измерительного устройства (например, ваттметра).

3. **Режим поддержания температуры:**
   - Отправьте команды для переключения нагревательных элементов в режим поддержания температуры.
   - Измерьте мощность нагрева и убедитесь, что она соответствует заданному проценту (5-10%).

4. **Считывание состояния нагревательных элементов:**
   - Отправьте запросы на считывание состояния нагревательных элементов.
   - Проверьте корректность передаваемой информации о состоянии нагревательных элементов.

5. **Документирование результатов:**
   - Запишите измеренные значения мощности нагревательных элементов в разных режимах.
   - Зафиксируйте результаты считывания состояния нагревательных элементов.

**Ожидаемый результат:**

- Симисторная плата корректно переключает нагревательные элементы между режимами высокой мощности и поддержания температуры.
- Мощность нагрева соответствует заданным параметрам в каждом режиме.
- Информация о состоянии нагревательных элементов считывается и передаётся корректно.
- Нет перегрева компонентов симисторной платы при выполнении тестов.

## Тестирование Защиты и Безопасности

### Проверка срабатывания защиты от перенапряжения и обратной полярности

**Цель:** Убедиться, что системы защиты корректно реагируют на перенапряжение и обратную полярность питания, предотвращая повреждение компонентов.

**Шаги:**

1. **Подготовка оборудования:**
   - Используйте симулятор перенапряжения или регулируемый источник питания для подачи обратной полярности.
   - Подключите материнскую плату к источнику питания через соответствующие разъёмы.

2. **Проверка перенапряжения:**
   - Подавайте напряжение выше номинального (например, 30 В) на вход питания.
   - Наблюдайте за срабатыванием защитных схем (например, плавких предохранителей, варисторов).

3. **Проверка обратной полярности:**
   - Подключите питание с обратной полярностью (например, +24V вместо -24V и наоборот).
   - Наблюдайте за срабатыванием защитных элементов (например, диодов защиты).

4. **Измерение напряжений после защиты:**
   - Измерьте напряжение на линиях питания после срабатывания защиты.
   - Убедитесь, что напряжение не превышает допустимые значения.

5. **Документирование результатов:**
   - Запишите моменты срабатывания защитных схем.
   - Зафиксируйте измеренные напряжения после срабатывания защиты.

**Ожидаемый результат:**

- Защитные схемы корректно срабатывают при перенапряжении и обратной полярности питания.
- Напряжение на линиях питания после защиты не превышает допустимые пределы.
- Компоненты платы не повреждаются при испытаниях.

### Проверка защиты от статического электричества

**Цель:** Убедиться, что система устойчиво реагирует на статические разряды, предотвращая повреждение электронных компонентов.

**Шаги:**

1. **Подготовка оборудования:**
   - Используйте шерстяной свитер для создания статических разрядов.
   - Подключите материнскую плату и все дочерние платы к источнику питания.

2. **Испытание на ESD:**
   - Проведите испытание, подавая разряды на все входные и выходные разъёмы плат.
   - Выполните тестирование как при нормальных условиях, так и при максимальных допустимых режимах работы дочерних плат.

3. **Проверка функциональности после ESD:**
   - После каждого разряда проверьте работу плат, выполняя базовые функции (например, обмен данными, управление линиями RTS).
   - Убедитесь в отсутствии сбоев или повреждений.

4. **Документирование результатов:**
   - Запишите количество разрядов, которым подвергалась система.
   - Зафиксируйте результаты проверки функциональности после каждого разряда.

**Ожидаемый результат:**

- Платы устойчиво реагируют на статические разряды, не повреждаясь.
- Функциональные возможности системы сохраняются после испытаний на ESD.
- Нет появления сбоев или неисправностей после воздействия статического электричества.

## Дополнительные Идеи для Тестирования

- **Тестирование кабельной трассы и экранирования**
- **Тестирование в климатической камере (шкаф с нагревателями, термопарой и ПИД-регулятором)**
- **Механическое тестирование краевых разъёмов (достать-запихать обратно)**
- **Тестирование внезапных отключений (как питания отдельных плат, так и внешнего)**

---

# Инструкция для Выполнения Тестов

## Общие рекомендации

1. **Подготовка:**
   - Убедитесь, что все необходимые инструменты и оборудование готовы к использованию (мультиметр, осциллограф, шерстяной свитер, источники питания с регулируемым напряжением и т.д.).
   - Проверьте наличие и корректность загрузки всех необходимых прошивок на соответствующие платы.

2. **Безопасность:**
   - Соблюдайте меры предосторожности при работе с высоким напряжением (например, 230 В на симисторных платах).
   - Используйте защитные очки и перчатки при необходимости.
   - Убедитесь, что оборудование заземлено для предотвращения поражения электрическим током.

3. **Документирование:**
   - Ведите подробные записи всех выполненных шагов, измеренных значений и наблюдаемых результатов.
   - Зафиксируйте любые отклонения от ожидаемых результатов для последующего анализа и устранения.

4. **Повторяемость:**
   - Выполняйте тесты несколько раз для подтверждения стабильности и надёжности результатов.
   - В случае обнаружения неисправностей повторите тестирование для подтверждения проблемы.

## Детализированный Тестовый Сценарий

### Полное описание теста обмена данными между платой контроллера и дочерними платами

**Цель:** Проверить надёжность и скорость обмена данными между платой контроллера и всеми дочерними платами через шину RS485, а также корректность обработки данных.

**Необходимое оборудование:**
- Материнская плата
- Плата контроллера
- Дочерние платы (плата двигателей, симисторная плата и др.)
- Компьютер с установленным программным обеспечением для мониторинга RS485
- Прошивки: `controller_test`, `data_exchange_test`

**Шаги:**

1. **Подключение оборудования:**
   - Установите материнскую плату на тестовый стенд.
   - Подключите плату контроллера к материнской плате через соответствующие разъёмы.
   - Подключите все дочерние платы к плате контроллера через шину RS485.
   - Подключите плату контроллера к компьютеру через интерфейс RS485.

2. **Загрузка прошивок:**
   - Загрузите прошивку `controller_test` на плату контроллера.
   - Загрузите прошивку `data_exchange_test` на все дочерние платы, участвующие в тесте.

3. **Инициализация обмена данными:**
   - Запустите программное обеспечение на компьютере для мониторинга обмена данными.
   - Инициализируйте соединение через RS485, убедившись, что все платы корректно подключены и распознаны системой.

4. **Отправка тестовых данных:**
   - С платы контроллера отправьте пакет данных (например, 10 байт) на каждую дочернюю плату.
   - Используйте уникальные идентификаторы для каждой платы для проверки адресации.

5. **Измерение задержки:**
   - Зафиксируйте время отправки и получения каждого пакета данных.
   - Рассчитайте среднюю задержку передачи данных между платой контроллера и дочерними платами.

6. **Проверка целостности данных:**
   - Сравните отправленные и полученные данные на каждой дочерней плате.
   - Убедитесь, что данные передаются без ошибок и искажений.

7. **Тестирование устойчивости:**
   - Продолжайте отправлять данные в течение 10 минут, наблюдая за стабильностью соединения и отсутствием потерь данных.
   - Внезапно отключите одну из дочерних плат и затем снова подключите её, проверяя восстановление соединения и обмена данными.

8. **Документирование результатов:**
   - Запишите все измеренные задержки, результаты проверки целостности данных и наблюдаемые аномалии.
   - Зафиксируйте время восстановления соединения после отключения платы.

**Ожидаемый результат:**

- Данные передаются между платой контроллера и дочерними платами без ошибок и потерь.
- Средняя задержка передачи данных находится в пределах допустимых значений (например, менее 100 мс).
- Соединение остаётся стабильным при непрерывном обмене данными.
- После отключения и повторного подключения платы соединение восстанавливается автоматически, и обмен данными продолжается корректно.

# Необходимые Прошивки для Тестов

## Описание функционала каждой прошивки

### 1. `controller_test`

**Функционал:**
- Инициализирует обмен данными через RS485.
- Управляет линиями RTS, поднимая и опуская их согласно тестовым командам.
- Отправляет и принимает тестовые данные для проверки целостности передачи.

### 2. `dc_motor_test`

**Функционал:**
- Управляет моторами постоянного тока.
- Изменяет направление вращения моторов.
- Регулирует скорость вращения с шагом 1% с использованием ШИМ.
- Останавливает моторы по команде.

### 3. `triac_control_test`

**Функционал:**
- Управляет симисторами для регулировки мощности нагревательных элементов.
- Переключает режимы работы нагревательных элементов (высокая мощность, режим поддержания).
- Считывает и передаёт информацию о состоянии нагревательных элементов.

### 4. `data_exchange_test`

**Функционал:**
- Взводит линию RTS.
- Отправляет 10 байт данных после взвода RTS.
- Считывает время отправки и получения данных.
- Сравнивает отправленные и полученные данные на корректность.

---

# Пример использования прошивок в тестах

## Пример тестового сценария с использованием `data_exchange_test`

**Цель:** Проверить корректность обмена данными между платой контроллера и дочерними платами с использованием прошивки `data_exchange_test`.

**Шаги:**

1. **Подключение оборудования:**
   - Подключите материнскую плату (коммутационную платформу) и дочерние платы к источнику питания и шине RS485.
   - Подключите плату контроллера к материнской плате и дочерним платам.
   - Загрузите прошивку `data_exchange_test` на дочерние платы и `controller_test` на плату контроллера.

2. **Запуск теста:**
   - Запустите обмен данными через RS485.
   - Взведите линию RTS на плате контроллера, инициируя передачу данных.

3. **Отправка и получение данных:**
   - После взвода RTS отправьте 10 байт данных с платы контроллера на дочерние платы.
   - С дочерних плат примите данные и отправьте подтверждение обратно.

4. **Измерение времени задержки:**
   - Зафиксируйте время отправки данных и время получения подтверждения.
   - Рассчитайте задержку передачи данных.

5. **Проверка целостности данных:**
   - Сравните отправленные данные с полученными на дочерних платах.
   - Убедитесь в отсутствии искажений или потерь данных.

6. **Документирование результатов:**
   - Запишите измеренные задержки и результаты проверки целостности данных.
   - Зафиксируйте любые отклонения или ошибки в передаче данных.

**Ожидаемый результат:**

- Данные передаются без искажений и потерь.
- Задержка передачи данных находится в пределах допустимых значений.
- Подтверждение получения данных корректно отправляется и принимается.
- Все тестовые данные совпадают на отправляющей и принимающей сторонах.

---
